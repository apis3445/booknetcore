# 7.1.8 Configurando OData en el archivo Startup.cs

En nuestro archivo **Startup.cs** en el método **ConfigureServices** agregamos el siguiente código

{% code title="Startup.cs" %}
```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddControllers(options=>
    {
       options.Filters.Add(typeof(CustomExceptionFilter));
       foreach (var formatter in options.OutputFormatters
          .OfType<ODataOutputFormatter>()
          .Where(it => !it.SupportedMediaTypes.Any()))
              {
                   formatter.SupportedMediaTypes.Add(
                       new MediaTypeHeaderValue
                          ("application/prs.mock-odata"));
              }
              foreach (var formatter in options.InputFormatters
                     .OfType<ODataInputFormatter>()
                        .Where(it => !it.SupportedMediaTypes.Any()))
                        {
                                formatter.SupportedMediaTypes.Add(
                                    new MediaTypeHeaderValue
                                    ("application/prs.mock-odata"));
                        }
    }
    services.AddOData();
    services.AddMvcCore(options =>
      {
          foreach (var outputFormatter in 
           options.OutputFormatters.OfType<ODataOutputFormatter>()
               .Where(_ => _.SupportedMediaTypes.Count == 0))
          {
              outputFormatter.SupportedMediaTypes.Add(
                   new Microsoft.Net.Http.Headers
                   .MediaTypeHeaderValue(
                   "application/prs.odatatestxx-odata"));
          }
          foreach (var inputFormatter in options.InputFormatters
              .OfType<ODataInputFormatter>().Where
              (_ => _.SupportedMediaTypes.Count == 0))
          {
              inputFormatter.SupportedMediaTypes.Add(
                 new Microsoft.Net.Http.Headers.MediaTypeHeaderValue(
                 "application/prs.odatatestxx-odata"));
          }
      });
}
```
{% endcode %}

En el método Configure agregamos las rutas para manejar OData. También agregamos la función para traernos el modelo.

```csharp
public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
{
    app.UseMvc(routeBuilder =>
    {
                routeBuilder.Select().Expand().Filter()
                    .OrderBy().MaxTop(100).Count();
                routeBuilder.MapODataServiceRoute(
                         "odata", "odata", GetEdmModel());
                routeBuilder.EnableDependencyInjection();   
    });
}

private static IEdmModel GetEdmModel()
{
    ODataConventionModelBuilder builder = new 
                            ODataConventionModelBuilder();
    builder.EntitySet<Cliente>("Clientes");
    builder.EntitySet<ClienteCategoria>("ClientesCategorias");
    builder.EntitySet<Caducidad>("Caducidad");
    return builder.GetEdmModel();
}
```



