# 7.14 Guardando el historial de cambios

Puedes agregar otro action filter para ir registrando todos los cambios que realizan los usuarios al sistema, vamos a registrar el usuario, la fecha en que se realiza el cambio, y un campo adicional para agregar opciones adicionales, como por ejemplo mostrar algún valor anterior. 

Agregamos nuesta clase HistorialDB para registrar el historial de los usuarios.

Agregamos una Enumeración con los tipos de actividades que los usuarios pueden realizar. 

Para esto agregamos una propiedad llamada **Id** de tipo **entero** a nuestra clase **BaseController,** aqui vamos a agregar el Id de cada registro que se este actualizando

{% code-tabs %}
{% code-tabs-item title="BaseController.cs" %}
```csharp
public class BaseController : Controller
{
    public int Id;
    public string Observaciones;
}
```
{% endcode-tabs-item %}
{% endcode-tabs %}

En **ProductosController** a los métodos Post, Put y Delete vamos a agregar el Id del registro

{% code-tabs %}
{% code-tabs-item title="ProductosController.cs" %}
```csharp
public class ProductosController : BaseController
{
    [HttpPost]
    public async Task<IActionResult> PostProducto(
                                       [FromBody] Producto producto)
    {
        if (!await productoDAO.AgregarAsync(producto))
        {
            return StatusCode(productoDAO.customError.StatusCode,
                                  productoDAO.customError.Message);
        }
        Id = producto.Id;
        return CreatedAtAction("GetCategoria", 
                              new { id = producto.Id }, producto);
    }
    
    [HttpPut("{id}")]
    public async Task<IActionResult> PutProducto([FromRoute] int id, [FromBody] Producto producto)
    {
        if (!ModelState.IsValid)
            return BadRequest(ModelState);

        if (id != producto.Id)
             return BadRequest();

        if (!await productoDAO.ModificarAsync(producto))
        {
            return StatusCode(productoDAO.customError.StatusCode,
                                  productoDAO.customError.Message);
        }
        Id = producto.Id;
        return NoContent();
    }
    
    [HttpDelete("{id}")]
    public async Task<IActionResult> DeleteProducto([FromRoute] int id)
    {
        if (!ModelState.IsValid)
            return BadRequest(ModelState);
        if (!await productoDAO.BorraAsync(id))
        {
                return StatusCode(productoDAO.customError.StatusCode,
                                  productoDAO.customError.Message);
        }
        Id = id;
        return Ok();
    }
```
{% endcode-tabs-item %}
{% endcode-tabs %}

En nuestra carpeta Filters agregamos un nueva clase **HistorialFilter**

{% code-tabs %}
{% code-tabs-item title="HistorialFilter.cs" %}
```csharp

```
{% endcode-tabs-item %}
{% endcode-tabs %}

