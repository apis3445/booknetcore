# 7.6 Agregando usuarios y roles

Para agregar el usuario vamos a crear una función para que nos genere el salt. 

En nuestra carpeta **Core** agregamos una nueva clase llamada **Seguridad** y agregamos una función **GetSalt**, esta función nos regresa una cadena aleatoria. 

También agregamos la función  GetHash el cual nos devolverá el hash de la cadena de texto que enviamos como parámetro.

{% code-tabs %}
{% code-tabs-item title="Seguridad.cs" %}
```csharp
using System;
using System.Security.Cryptography;

namespace CaducaRest.Core
{
    public class Seguridad
    {
        public Seguridad()
        {
        }

        public string GetSalt()
        {
            byte[] bytes = new byte[128 / 8];
            using (var keyGenerator = RandomNumberGenerator.Create())
            {
                keyGenerator.GetBytes(bytes);
                return BitConverter.ToString(bytes).ToLower();
            }
        }
        
        public string GetHash(string text)
        { 
            using (var sha256 = SHA256.Create())
            {  
                var hashedBytes = sha256
                        .ComputeHash(Encoding.UTF8.GetBytes(text));
                return BitConverter
                     .ToString(hashedBytes).ToLower();
            }
        }
     }
}
```
{% endcode-tabs-item %}
{% endcode-tabs %}

En nuestra carpeta **DAO** creamos nuestra clase **UsuarioDAO**, en la función **agregarUsuario**, agregamos las funciones que creamos para guardar el salt y el password con un hash

{% code-tabs %}
{% code-tabs-item title="UsuarioDAO.cs" %}
```csharp
public class UsuarioDAO
{
    private readonly CaducaContext contexto;
    private readonly LocService localizacion;

    public CustomError customError;

    public UsuarioDAO(CaducaContext context, LocService locService)
    {
        this.contexto = context;
        this.localizacion = locService;
    }

    public async Task<bool> AgregarAsync(Usuario usuario)
    {
        contexto.Usuario.Add(usuario);
        Seguridad seguridad = new Seguridad();
        usuario.Adicional1 = seguridad.GetSalt();
        usuario.Password = seguridad.GetHash(usuario.Password 
                                                 + usuario.Adicional1);
        await contexto.SaveChangesAsync();
        return true;
    }
}
```
{% endcode-tabs-item %}
{% endcode-tabs %}

En nuestro archivo CaducaContext, en la región de los inserts agregamos el usuario



