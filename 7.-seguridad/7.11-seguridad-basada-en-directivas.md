# 7.11 Seguridad basada en directivas

Debido a que la seguridad basada en tokens solo verifica con los claims que se agregaron en el login, si luego por ejemplo un usuario ya no tiene ese claim, solo se le actualizara la lista de claims en el token hasta el momento en que el usuario vuelva a iniciar sesión y obtenga un token nuevo.

Existe otra forma de validar los servicios con seguridad basada en directivas la cual te permite agregar la validación antes de ejecutar cada servicio.

Para este ejemplo vamos a crear una tabla para nuestras páginas y a cada página le vamos a dar sus propios permiso, por ejemplo la página de productos tendra permisos para crear, borrar, modificar, consultar, la página de categorias tendra tambien los mismos permisos, y se tendra un permiso para las páginas a las cuales solo un usuario administrador debe poder tener acceso.

Agregare un permiso para cada tipo de operación, Crear,  Modificar, Borrar, Consultar, Autorizar, Cancelar, etc según los necesite tu aplicación. Puedes utilizar la clase de .NET [OperationAuthorizationRequirement](https://docs.microsoft.com/es-es/dotnet/api/microsoft.aspnetcore.authorization.infrastructure.operationauthorizationrequirement)  la cual nos facilita registrar todos los posibles permiso que maneja tu aplicación. Creamos una clase **Operaciones** en nuestra carpeta **Core**

{% code-tabs %}
{% code-tabs-item title="Operaciones.cs" %}
```csharp
public static class Operaciones
{
    public static OperationAuthorizationRequirement Crear = new
            OperationAuthorizationRequirement
    { Name = "Crear" };
    public static OperationAuthorizationRequirement Modificar = new
            OperationAuthorizationRequirement
    { Name = "Modificar" };
    public static OperationAuthorizationRequirement Borrar = new
            OperationAuthorizationRequirement
    { Name = "Borrar" };
    public static OperationAuthorizationRequirement Consultar = new
            OperationAuthorizationRequirement
    { Name = "Consultar" };
}
```
{% endcode-tabs-item %}
{% endcode-tabs %}

Creamos una clase PermisoDTO el cual nos indica que página deseamos validar.

Para nuestras reglas personalizadas necesitamos que nuestra clase herede de **AuthorizationHandler,** la cual recibe como objetos génericos un objeto de la clase OperationAuthorizationRequirement y cualquier otro dato adicional en nuetro caso es nuestra clase **Permiso**





