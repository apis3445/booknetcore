# 8.6 Agregando pruebas para las Categorías

En nuestro proyecto **xUnit.CaducaRest** vamos a crear una nueva clase llamada **CategoriasTests** esta clase tendra todas las pruebas unitarias para la tabla Categorias.

Como primer prueba vamos a probar la regla para validar que no se pueda crear una categoría con el mismo nombre.

Como comentarios indicamos que ya conocemos que existe una categoría con el nombre **Análgesicos** ya que este fue creado en la base de datos en memoria.

Como nombre le ponemos el nombre de la regla que vamos a probar, en el caso de la categoría la clase se llama **AgregarNombreRegla**, luego indicamos el caso a probar, en este caso **NombreRepetido** y al final agregamos el valor esperado, en este caso sería **Falso**, de esta forma indicamos que en la tabla Categoría hay una una regla que debe regresar falso si el nombre ya existe.

En el constructor de la clase inicializamos la base de datos en memoria y el objeto locService.

Mandamos llamar a la función **ValidarRegla** de nuestra clase **AgregarNombreRegla** y el valor esperado deberia ser **falso**, con **Assert.False** comprobamos que el valor regresado por la función sea **False**.

{% code-tabs %}
{% code-tabs-item title="CategoriaTests.cs" %}
```csharp
public class CategoriaTests
{
    CaducaContext contexto;
    LocService locService;
    public CategoriaTests()
    {
        contexto = new CaducaContextMemoria().ObtenerContexto();
        locService = new MockLocService().ObtenerLocService();
    }
    /// <summary>
    /// Validamos que no se pueda agregar una categoria con un nombre repetido
    /// Dado que ya existe una categoría con el nombre Análgesicos
    /// Si queremos agregar una categoría con el mismo nombre
    /// El resultado deberia ser falso
    /// </summary>
    [Fact]
    public void AgregarNombreRegla_NombreRepetido_Falso()
    {
        AgregarNombreRegla agregarNombreRegla = new AgregarNombreRegla("Análgesicos", contexto, locService);
        Assert.False(agregarNombreRegla.ValidarRegla());
    }
}
```
{% endcode-tabs-item %}
{% endcode-tabs %}

Por lo general en las pruebas unitarias se prueban los posibles casos, en nuestro caso la regla debe regresar true si el nombre no existe

{% code-tabs %}
{% code-tabs-item title="CategoriaTests.cs" %}
```csharp
/// <summary>
/// Validamos que no se pueda agregar una categoria con un nombre repetido
/// El resultado deberia ser true
/// </summary>
[Fact]
public void AgregarNombreRegla_NombreNoRepetido_Verdadero()
{
    AgregarNombreRegla agregarNombreRegla = new AgregarNombreRegla("Antibioticos", contexto, locService);
    Assert.True(agregarNombreRegla.ValidarRegla());
}
```
{% endcode-tabs-item %}
{% endcode-tabs %}

De esta forma nos aseguramos que futuros cambios a nuestro código no vayan a provocar nuevos errores.

Puedes probar también la función Agregar

{% code-tabs %}
{% code-tabs-item title="CategoriasTest.cs" %}
```csharp
/// <summary>
/// Probamos que se pueda agregar una nueva categoría
/// </summary>
/// <returns></returns>
[Fact]
public async Task AgregarNueva_Categoria_VerdaderoAsync()
{
    var categoriaDAO = new CategoriaDAO(contexto, locService);
    Assert.True(await categoriaDAO.AgregarAsync
           (new Categoria { Clave = 2, Nombre = "Antibióticos" }));
}
```
{% endcode-tabs-item %}
{% endcode-tabs %}



