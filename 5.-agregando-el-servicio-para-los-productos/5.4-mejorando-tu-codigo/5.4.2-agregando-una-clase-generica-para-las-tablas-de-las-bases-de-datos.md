# 5.4.2 Agregando una clase genérica para las tablas de las bases de datos

Si observamos el código de nuestras clases de acceso a las bases de datos es batante simililar, para evitar estar repitiendo el código, vamos a crear una clase genérica con los métodos comunes como son obtener todos los registros, obtener un registro por id, agregar, modificar y borrar un registro.

Primero vamos a crear una interfaz llamada IAccesoDao el cual contiene los métodos comunes, el cual utliza generics, en el cual se recibe un objeto como parámetro, este objeto sera el nombre de la clase de la base de datos, por ejemplo Categoria, Producto.

{% code-tabs %}
{% code-tabs-item title="IAccesoDao.cs" %}
```csharp
public interface IAccesoDAO<T> where T : class
{
    CustomError customError { get; set; }
    Task<List<T>> ObtenerTodoAsync();       
    Task<T> ObtenerPorIdAsync(int id);
    Task<bool> AgregarAsync(T registro, List<IRegla> reglas);
    Task<bool> ModificarAsync(T registro, List<IRegla> reglas);
    Task<bool> BorraAsync(int id, List<IRegla> reglas);
}
```
{% endcode-tabs-item %}
{% endcode-tabs %}

Como cada tabla puede tener diferentes validaciones para agregar, borrar o modificar vamos a agregar una interfaz que nos permita validar cada regla de forma individual. Por ejemplo podemos tener una regla para validar que el nombre de la categoria no se repita. Otra regla para validar que no se repita la clave de la categoria. De esta forma podemos probar las reglas de forma individual para encontrar mas rápido algún error.

{% code-tabs %}
{% code-tabs-item title="IRegla.cs" %}
```csharp
public interface IRegla
{   
    CustomError customError { get; set; }
    bool ValidarRegla();
}
```
{% endcode-tabs-item %}
{% endcode-tabs %}

Ahora vamos a crear una clase AccesoDAO el cual tiene el código general para las tablas

{% code-tabs %}
{% code-tabs-item title="AccesoDAO.cs" %}
```csharp
public class AccesoDAO<TEntity> : IAccesoDAO<TEntity> where TEntity : class
{
    private readonly CaducaContext contexto;
    private readonly LocService localizacion;
    public CustomError customError { get; set; }

    public AccesoDAO(CaducaContext context, LocService locService)
    {
        this.contexto = context;
        this.localizacion = locService;
    }

    public async Task<bool> AgregarAsync(TEntity registro, List<IRegla> reglas)
    {       
        foreach(var regla in reglas)
        {
            if (!regla.ValidarRegla())
            {
                customError = regla.customError;
                return false;
            }
        }
        contexto.Set<TEntity>().Add(registro);
        await contexto.SaveChangesAsync();

        return true;
    }

    public async Task<bool> BorraAsync(int id, List<IRegla> reglas,string nombreTabla)
    {
         var registro = await ObtenerPorIdAsync(id);
         if (registro == null)
         {
             customError = new CustomError(404, String.Format(
               this.localizacion.GetLocalizedHtmlString("NotFound"), nombreTabla),
                "Id");
             return false;
          }
          contexto.Set<TEntity>().Remove(registro);
          await contexto.SaveChangesAsync();
          return true;
    }

    public async Task<bool> ModificarAsync(TEntity registro, List<IRegla> reglas)
    {           
        contexto.Entry(registro).State = EntityState.Modified;
        await contexto.SaveChangesAsync();
        return true;
    }
        
    public  async Task<TEntity> ObtenerPorIdAsync(int id)
    {
            return await contexto.Set<TEntity>().FindAsync(id);
    }

     public async Task<List<TEntity>> ObtenerTodoAsync()
     {
         return await contexto.Set<TEntity>().ToListAsync();
     }     
}
```
{% endcode-tabs-item %}
{% endcode-tabs %}

