# 9.3 Integración continua y pruebas automáticas en Azure DevOps

Para configurar Pipelines con Azure DevOps nos registramos en el siguiente link

[https://azure.microsoft.com/es-es/services/devops/pipelines/](https://azure.microsoft.com/es-es/services/devops/pipelines/)

![](../.gitbook/assets/image%20%28301%29.png)

Creamos un nuevo proyecto, elegí público para que este disponible

![](../.gitbook/assets/image%20%28217%29.png)

Seleccionamos GitHub

![](../.gitbook/assets/image%20%28182%29.png)

Seleccionamos el repositorio donde tenemos el código en mi caso es CaducaRest

![](../.gitbook/assets/image%20%2857%29.png)

Seleccionamos la opción: **ASP .NET Core \(.NET Framework\)** esta opción te configura el pipeline para generar el build de tu proyecto y luego ejecutar el proyecto de pruebas automáticas

![](../.gitbook/assets/image%20%2869%29.png)

Edita la tarea paraa indicar la versión 3.1.102 ya que de momento aun no se encuentra disponible de forma automática en Azure Pipelines,  por lo que si no especificas el sdk te marcara un error porque no encuentra el sdk 3.1.2

```text
- task: UseDotNet@2 
  displayName: ".NET Core 3.1.x"
  inputs:
        version: '3.1.102'
        packageType: sdk
- script: dotnet build --configuration $(buildConfiguration)
  displayName: 'dotnet build $(buildConfiguration)'
```

La parte de pruebas la cambiamos para agregar el nombre de nuestro proyecto de pruebas unitarias

```text
- task: VSTest@2
  inputs:
    testSelector: 'testAssemblies'
    testAssemblyVer2: |
      **\xUnit.CaducaRest.dll
      !**\*TestAdapter.dll
      !**\obj\**
    searchFolder: '$(System.DefaultWorkingDirectory)'
```

Y damos clic en Run

![](../.gitbook/assets/image%20%28186%29.png)

Si todo es correcto vemos esta pantalla

![](../.gitbook/assets/image%20%28155%29.png)

Podemos ver los pasos que se estan ejecutando

![](../.gitbook/assets/image%20%28267%29.png)

Si todo es correcto vemos esta pantalla

![](../.gitbook/assets/image%20%28213%29.png)

Puedes dar clic en la sección VSTest y verás el resultado de tus pruebas, te llega un correo con el resultado del build

![](../.gitbook/assets/image%20%28188%29.png)

Cambiamos la función Sumar para que reste, le damos commit para ver el error, de esta forma cada vez que realices un commit se ejecutaran las pruebas con Azure DevOps

![](../.gitbook/assets/image%20%28139%29.png)

Si damos clic vemos el detalle

![](../.gitbook/assets/image%20%28198%29.png)

Este a este momento tiene los siguientes precios

![](../.gitbook/assets/image%20%28290%29.png)

El archivo yaml queda de la siguiente forma

```text
# ASP.NET Core (.NET Framework)
# Build and test ASP.NET Core projects targeting the full .NET Framework.
# Add steps that publish symbols, save build artifacts, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/dotnet-core

trigger:
- master

pool:
  vmImage: 'windows-latest'

variables:
  solution: '**/*.sln'
  buildPlatform: 'Any CPU'
  buildConfiguration: 'Release'
  system.debug: false

steps:

- task: UseDotNet@2 
  displayName: ".NET Core 3.1.x"
  inputs:
        version: '3.1.102'
        packageType: sdk
- script: dotnet build --configuration $(buildConfiguration)
  displayName: 'dotnet build $(buildConfiguration)'

- task: CopyFiles@2
  displayName: Copy postman scripts
  inputs:
    SourceFolder: 'postman'
    Contents: '**'
    TargetFolder: '$(Build.ArtifactStagingDirectory)/postman'

- task: VSTest@2
  displayName: Testing Unit Test
  inputs:
    testSelector: 'testAssemblies'
    testAssemblyVer2: |
      **\xUnit.CaducaRest.dll
      !**\*TestAdapter.dll
      !**\obj\**
    searchFolder: '$(System.DefaultWorkingDirectory)'
```

También te genera un resumen de los Test que pasaron, y la cobertura de código, la cual te indica el porcentaje de código que contiene pruebas automáticas.En el ejemplo solo el 6.11% del código tiene alguna prueba automática

![](../.gitbook/assets/image%20%28145%29.png)

